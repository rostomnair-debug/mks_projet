{% extends 'base.html.twig' %}

{% block title %}MKS | Demande{% endblock %}

{% block breadcrumb %}
    <a href="{{ path('home') }}">Accueil</a>
    <span class="mx-2">›</span>
    <a href="{{ path('admin_dashboard', {tab: 'contacts'}) }}">Admin demandes</a>
    <span class="mx-2">›</span>
    <span>Demande #{{ request.id }}</span>
{% endblock %}

{% block body %}
<section class="admin-shell">
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-4">
        <div>
            <h1 class="h4 mb-1">Demande #{{ request.id }}</h1>
            <p class="text-muted mb-0">{{ request.subject }}</p>
        </div>
        <a class="btn btn-outline-primary btn-pill" href="{{ path('admin_dashboard', {tab: 'contacts'}) }}">Retour</a>
    </div>

    <div class="admin-card mb-4">
        <div class="row g-3">
            <div class="col-12 col-md-6"><strong>Nom:</strong> {{ request.name }}</div>
            <div class="col-12 col-md-6"><strong>Email:</strong> {{ request.email }}</div>
            <div class="col-12 col-md-6"><strong>Date:</strong> {{ request.createdAt|date('d/m/Y H:i') }}</div>
            <div class="col-12 col-md-6"><strong>Statut:</strong> {{ request.status }}</div>
            <div class="col-12 col-md-6"><strong>Événement:</strong> {{ request.event ? request.event.title : '' }}</div>
            <div class="col-12 col-md-6"><strong>Places:</strong> {{ request.requestedQuantity }}</div>
            {% if request.targetUrl %}
                <div class="col-12"><strong>Événement:</strong> <a href="{{ request.targetUrl }}">Voir l'événement</a></div>
            {% endif %}
        </div>
        <div class="mt-3">
            <strong>Message:</strong>
            <p class="mb-0">{{ request.message }}</p>
        </div>
    </div>

    <div class="admin-card">
        {{ form_start(form) }}
            {{ form_errors(form) }}
            {{ form_row(form.adminResponse) }}
            <button class="btn btn-primary btn-pill w-100" type="submit">Envoyer la réponse</button>
        {{ form_end(form) }}
        <p class="text-muted small mt-3">* champs obligatoires</p>
        {% if request.status != 'confirmed' and request.event and request.requestedQuantity > 0 %}
            <form class="mt-3" method="post" action="{{ path('admin_contact_confirm', {id: request.id}) }}">
                <input type="hidden" name="_token" value="{{ csrf_token('confirm_contact_' ~ request.id) }}">
                <button class="btn btn-secondary btn-pill w-100" type="submit">Confirmer la réservation</button>
            </form>
        {% endif %}
    </div>
</section>
{% endblock %}
